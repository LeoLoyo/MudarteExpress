<div>
    <div class="col-md-12">
      <div id="id_divContenedor" class="">
        <br>

        <div id="div1">
          <br>
        <table class="tablaResumen">
          <tr>
            <td rowspan="3">
              <p><strong>4701-1177<strong></p>
              <p><strong>WWW.MUDARTE.COM.AR<strong></p>
              <p>info@mudarte.com.ar </p>
              <p>3 de Febrero 3455 / Nuñez</p>
            </td>
            <td rowspan="3">
              <h2>Cotización<a href="javascript:schemeOrgPdf()">Download PDF</a></h2>
            </td>
            <td rowspan="3" colspan="2">
              <img src="img/LogoMudarte.png" alt="">
            </td>
            <td style="background-color: #fff;" class="tdResumen" align=center>N° Cotiz.</td>
            <td>{{cotizacion.numero_cotizacion}}</td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fuente</td>
            <td>{{cotizacion.fuente}}</td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Particular</td>
            <td><strong ng-if="cotizacion.tipo_cliente ==='Particular'">X</strong></td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Nombre y Apellido:</td>
            <td colspan="3">{{cliente.nombre}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Empresa</td>
            <td><strong ng-if="cotizacion.tipo_cliente ==='Empresa'">X</strong></td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Teléfono:</td>
            <td colspan="3">{{cliente.telefono}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Gobierno</td>
            <td><strong ng-if="cotizacion.tipo_cliente ==='Gobierno'">X</strong></td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Correo electronico:</td>
            <td colspan="3">{{cliente.email}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Cargo</td>
            <td>{{cotizacion.cargo}}</td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Nombre de la empresa: </td>
            <td colspan="3">{{cotizacion.cp_pv}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Cotizador</td>
            <td>{{cotizacion.cotizador.first_name}} {{cotizacion.cotizador.last_name}}</td>
          </tr>
          <!-- <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha en que se cargó:</td>
            <td>{{cotizacion.fecha_de_carga | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td>{{cotizacion.hora_de_carga | date:'HH:mm'}}</td>

          </tr> -->
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha estimada de mudanza:</td>
            <td>{{cotizacion.fecha_estimada_mudanza | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td style="border-right:1px solid #dedede;">{{cotizacion.hora_estimada_mudanza | date:'HH:mm'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Forma pago</td>
            <td class="" style="border-bottom: 1px solid #dedede;">{{cotizacion.forma_pago}}</td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha en que se cotizó:</td>
            <td>{{cotizacion.fecha_de_cotizacion | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td style="border-right:1px solid #dedede;">{{cotizacion.hora_de_cotizacion | date:'HH:mm'}}</td>
          </tr>
          <!-- <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha en que se avisó:</td>
            <td>{{cotizacion.fecha_de_aviso | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td>{{cotizacion.hora_de_aviso | date:'HH:mm'}}</td>
          </tr> -->
          <!-- <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha en que se cerró:</td>
            <td>{{cotizacion.fecha_de_cierre | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td>{{cotizacion.hora_de_cierre | date:'HH:mm'}}</td>
          </tr> -->
          <!-- <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Fecha real de mudanza:</td>
            <td>{{cotizacion.fecha_real_mudanza | date:'dd-MM-yyyy'}}</td>
            <td style="background-color: #fff;" class="tdResumen" align=center>Hora:</td>
            <td>{{cotizacion.hora_real_mudanza | date:'HH:mm'}}</td>
          </tr> -->
          <!-- <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Nombre de quien pasó la cotización:</td>
            <td>
              {{cotizacion.quien_cotizo}}
            </td>
            <td class="tdResumen" colspan="4"></td>
          </tr>
          <tr>
            <td style="background-color: #fff;" class="tdResumen" align=center>Nombre de quien llamó al cliente:</td>
            <td>{{cotizacion.quien_llamo}}</td>
            <td class="tdResumen" colspan="4"></td>
          </tr> -->
          <tr>
            <th style="background-color: #fff; border-right: 1px solid #dedede;" class="tdResumen" colspan="2" align=center >Domicilio de Origen:</th>
            <th style="background-color: #fff;align=center;"  class="tdResumen" colspan="4">Barrio/Provincia:</th>
          </tr>
          <tr>
            <td colspan="2" style="border-right: 1px solid #dedede;">{{cotizacion.direccion_origen}}</td>
            <td>{{cotizacion.barrio_provincia_origen}}</td>
          </tr>
          <tr>
            <th style="background-color: #fff;" class="tdResumen" align=center colspan="6">Observaciones de Origen:</th>
          </tr>
          <tr>
            <td colspan="6">{{cotizacion.observacion_origen}}</td>
          </tr>
          <tr>
            <th style="background-color: #fff; border-right: 1px solid #dedede;" class="tdResumen" align=center colspan="2">Domicilio de Destino:</th>
            <th style="background-color: #fff;" class="tdResumen" align=center colspan="4">Barrio/Provincia:</th>
          </tr>
          <tr>
            <td colspan="2" style="border-right: 1px solid #dedede;">{{cotizacion.direccion_destino}}</td>
            <td>{{cotizacion.barrio_provincia_destino}}</td>
          </tr>
          <tr>
            <th style="background-color: #fff;" class="tdResumen" align=center colspan="6">Observaciones de Destino:</th>
          </tr>
          <tr>
            <td colspan="6">{{cotizacion.observacion_destino}}</td>
          </tr>
        </table>
        <legend></legend>
        <br>
        <h2>Detalle de mudanza</h2>
        <table class="tablaResumen">
          <tr>
            <td class="tdResumen" align="center">km</td>
            <td>{{cotizacion.recorrido_km}}</td>
            <td align="center" class="tdResumen">{{cotizacion.precio_km|currency}}</td>
            <td align="center" class="tdResumen">{{cotizacion.monto_km|currency}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Tiempo de carga</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.tiempo_de_carga}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Tiempo de descarga</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.tiempo_de_descarga}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Camión</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.numero_camion}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Ayudantes</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.numero_ayudante.num}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Seguro</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.seguro}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Desarme de Muebles</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.desarme_mueble}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Ambiente</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.ambiente.num}}</td>
          </tr>
          <tr>
            <td class="tdResumen" align="center">Rampa</td>
            <td align="center" colspan="2" class="tdResumen">{{cotizacion.rampa}}</td>
          </tr>
        </table>
        <legend></legend>
        <br>
        <h2>Materiales</h2>
        <table class="tablaResumen">
          <tr class="active">
            <th>Material</th>
            <th style="text-align:center!important;">Cantidad</th>
            <th width="200" style="text-align:center!important;">Precio unit.</th>
            <th width="200" style="text-align:right!important;">Totales</th>
          </tr>
          <tr ng-repeat="item in materiales_temp">
            <td>{{item.material}}</td>
            <td style="text-align:center!important;">{{item.cantidad}}</td>
            <td style="text-align:center!important;">{{item.precio_unitario}}</td>
            <td style="text-align:right!important;" >{{item.total|currency}}</td>
          </tr>
          <tr class="active">
            <td colspan="3" style="text-align:right!important;border-right: 1px solid #dedede;"><strong>Total:</strong></td>
            <td style="text-align:right!important;"><strong>{{cotizacion.materiales|currency}}</strong></td>
          </tr>
        </table>
        <legend></legend>
        <br>
        <h2>Presupuesto</h2>
        <table class="tablaResumen">
          <tr class="active">
            <th  class="tdResumen">Descripción</th>
            <th  class="tdResumen" style="width:400px;">Montos $</th>
          </tr>
          <tr>
            <td  class="tdResumen" width="40px;" >Mudanza</td>
            <td style="text-align:right!important;">{{cotizacion.mudanza|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="20%">Soga</td>
            <td style="text-align:right!important;">{{cotizacion.soga|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="20%">Embalaje</td>
            <td style="text-align:right!important;">{{cotizacion.embalaje|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="20%">Desembalaje</td>
            <td style="text-align:right!important;">{{cotizacion.desembalaje|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="20%">Materiales</td>
            <td style="text-align:right!important;">{{cotizacion.materiales|currency}}</td>
          </tr>
          <tr>
            <td class="tdResumen" width="20%">km</td>
            <td style="text-align:right!important;">{{cotizacion.monto_km|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="20%">Piano/C.fuerte</td>
            <td style="text-align:right!important;">{{cotizacion.piano_cajafuerte|currency}}</td>
          </tr>
          <tr class="active">
            <td  class="tdResumen" width="80%">Sub total</td>
            <td style="text-align:right!important;">{{cotizacion.subtotal1|currency}}</td>
          </tr>
          <tr>
            <td  class="tdResumen" width="80%">Ajuste</td>
            <td><span style="text-align:start;">
              % {{cotizacion.porcentaje_ajuste|number:2}}</span> <span style="float:right!important;"> {{cotizacion.ajuste|currency}}</span></td>
          </tr>
          <tr class="active">
            <td  class="tdResumen" width="80%">Sub total</td>
            <td style="text-align:right!important;">{{cotizacion.subtotal2|currency}}</td>
          </tr>
          <tr class="active">
            <td  class="tdResumen" width="80%">IVA</td>
            <td><span style="text-align:start;">% {{cotizacion.porcentaje_iva|number:2}}</span>
              <span style="float:right!important;">{{cotizacion.iva|currency}}</span></td>
          </tr>
          <tr class="active">
            <th  class="tdResumen" width="80%" style="text-align:right!important;border-right: 1px solid #dedede;">Total:</th>
            <td style="text-align:right!important;"><strong>{{cotizacion.total_monto|currency}}</strong></td>
          </tr>
        </table>
        <legend></legend>
        <br>
          <h2>Contenedores</h2>
          <table class="tablaResumen">
              <tr class="tdResumen active">
                <th>Contenedor</th>
                <th style="width:80px; padding:10px;">Cantidad</th>
                <th style="width:80px; padding:10px; padding-left:30px;">m<sup>3</sup></th>
              </tr>
              <tr ng-repeat="item in contenedores_temp">
                <td >{{item.descripcion}}</td>
                <td align="center">{{item.cantidad}}</td>
                <td align="center">{{item.punto/10|number:2}}</td>
              </tr>
              <tr class="active">
                <td style="text-align:right!important;border-right: 1px solid #dedede;"><strong>Total:</strong></td>
                <td align="center"><strong>{{unidades_contenedores}}</strong></td>
                <td align="center"><strong>{{metros3_contenedores|number:2}}</strong></td>
              </tr>
          </table>
          <legend></legend>
          <br>
          <h2>Muebles</h2>
          <table class="tablaResumen">
            <tr class="tdResumen active">
              <th>Mueble</th>
              <th style="text-align:center;">Dimensión</th>
              <th style="width:80px; padding:10px;">Cantidad</th>
              <th style="width:80px; padding:10px; padding-left:30px;">m<sup>3</sup></th>
            </tr>
            <tr ng-repeat="item in muebles_temp">
              <td>{{item.mueble}} {{item.especificacion}} {{item.descripcion}}</td><!-- cambio leo -->
              <td align="center">{{item.ancho}}x{{item.largo}}x{{item.alto}}</td>
              <td align="center">{{item.cantidad}}</td>
              <td align="center">{{item.total_punto/10|number:2}}</td>
            </tr>
            <tr ng-repeat="item in otros_temp">
              <td ng-if="item.mueble == 'Otros'">Otros-{{item.descripcion}}</td>
              <td ng-if="item.mueble != 'Otros'">{{item.mueble}}</td>
              <td align="center">{{item.ancho}}x{{item.largo}}x{{item.alto}}</td>
              <td align="center">{{item.cantidad}}</td>
              <td align="center">{{item.total_punto/10|number:2}}</td>
            </tr>
            <tr class="active">
              <td colspan="2" style="text-align:right!important;border-right: 1px solid #dedede;"><strong>Total:</strong></td>
              <td align="center"><strong>{{unidades_muebles + unidades_otros}}</strong></td>
              <td align="center"><strong>{{metros3_muebles + metros3_otros|number:2}}</strong></td>
            </tr>
          </table>
          <legend></legend>
          <br>
          <h2>Totales</h2>
          <table style="width:200px;" class="tablaResumen">
            <tr>
              <th colspan="2" class="tdResumen">Total m<sup>3</sup>:</th>
              <td align="center" class="tdResumen"><strong style="display:flex;"><span style="flex:10%;margin-top:auto;margin-bottom:auto;">{{metros3_contenedores+metros3_muebles+metros3_otros|number:2}}</span><span style="flex:10%;margin-top:auto;margin-bottom:auto;"> m<sup>3</sup></span></strong></td>
            </tr>
            <tr>
              <td class="paddingNone tdResumen" style="padding:0;display:flex;width:100px">
                <span ng-if="nav==='7'" ng-show="nav==='7'" style="flex:10%;padding-top:9px;height:34px;text-align:center;">{{cotizacion.porcentaje_margen}} %</span>
                <input ng-if="nav==='6'" ng-show="nav==='6'" type="number" class="form-control" style="flex:90%;border-radius:0;border:none;" min="0" ng-change="$emit('change_margen')" ng-model="cotizacion.porcentaje_margen"><span ng-if="nav==='6'" ng-show="nav==='6'" style="flex:10%;margin-top:auto;margin-bottom:auto;"> %</span>
              </td>
              <th class="tdResumen">Margen</th>
              <td class="tdResumen"><strong style="display:flex;"><span style="flex:90%;border-radius:0;border:none;">{{(metros3_contenedores+metros3_muebles+metros3_otros)*(1+(cotizacion.porcentaje_margen/100))|number:2}}</span> <span style="flex:10%;margin-top:auto;margin-bottom:auto;">m<sup>3</sup></span></strong></td>
            </tr>
          </table>
          <legend></legend>
          <table class="tablaResumen">
            <tr>
             <td align="center" colspan=7 class="active"><strong>Observaciones</strong></td>
           </tr>
           <tr>
             <th colspan=7></th>
           </tr>
           <tr>
             <td align="center" colspan=7>El valor de este trabajo es teniendo en cuenta lo detallado y proporcionado por usted. Si al momento de la realización existe alguna variación, el valor será modificado indefectiblemente.</td>
           </tr>
           <tr>
             <td align="center" colspan=7>Los precios cotizados no incluyen el I.V.A., que será adicionado en oportunidad de la factura. Los canastos y las cajas, serán entregados 2 días antes de la fecha de trabajo. Los canastos tendrán que ser devueltos luego de tres días de finalizado el trabajo. Pasados estos, el cliente deberá abonar la suma de $30,00 por canasto por día, más $500 por el servicio de retiro. La cantidad de materiales cotizados son estimados. Lo que significa que puede variar la cantidad y por consecuencia, el precio. (Los percheros se entregan y se retiran el día de la mudanza. Atención: los trabajos que sean realizados al interior o a alguna provincia que supere los 70km de Capital Federal, deberán hacer entrega de los canastos al finalizar el mismo. O bien pagar un canon por su retiro que lo dispondrá la empresa. Si en destino hubiera que subir algún tipo de mueble por medio de sogas y no fue cotizado en la visita, se deja explícitamente aclarado que el valor queda por fuera de este presupuesto. Y el precio del mismo se definirá teniendo en cuenta la complejidad y la cantidad de elementos a elevar. Una vez que el camión y el personal de MUDARTE se retiran del domicilio final, no se aceptaran reclamos de ningún tipo. El cliente deberá firmar el comprobante de conformidad. La cotización tiene una validez de 15 días, cumplido el plazo, el cliente deberá ponerse en contacto con MUDARTE para una Recotización.</td>
           </tr>
           <tr>
             <th colspan=7></th>
           </tr>
           </table>
      </div>
    </div>
</div>

<script type="text/javascript" src="jspdf.min.js"></script>
<script type="text/javascript" src="jspdf.debug.js"></script>
<script type="text/javascript" src="addimage.js"></script>
<script type="text/javascript" src="jspdf.plugin.table.js"></script>
<script type="text/javascript" src="html2canvas.js"></script>
<script type="text/javascript" src="canvas.js"></script>

<script>

var tamanoDiv = $('#id_divContenedor').outerHeight();
var pantalla = $(window).outerHeight();
var tamanoInicial = (pantalla - 75);
//$('#page-content-wrapper').height(pantalla);
//$('#id_divContenedor').height('5000px');

 function schemeOrgPdf() {
  $('#page-content-wrapper').height(8000+'px');
                var canvasShiftImg = function(img, shiftAmt, scale, pageHeight, pageWidth) {
                    var c = document.createElement('canvas'),
                            ctx = c.getContext('2d'),
                            shifter = Number(shiftAmt || 0);
                    c.style.background = "#fff";
                    if (contPage < 1) {
                        if (img.height - (-shifter) < 1108) {
                            canvasHeight = ctx.canvas.height = img.height - (-shifter);
                        } else {
                            canvasHeight = ctx.canvas.height = 1108;
                        }
                    } else {
                        if (img.height - (-shifter) < 1108) {
                            canvasHeight = ctx.canvas.height = img.height - (-shifter);
                        } else {
                            canvasHeight = ctx.canvas.height = 1108;
                        }
                    }
                    ctx.canvas.background = "white";
                    ctx.canvas.width = img.width;
                    ctx.drawImage(img, 0, -shifter, ctx.canvas.width, ctx.canvas.height, 0, 0, ctx.canvas.width, ctx.canvas.height);
                    return c;
                };
                var canvasToImg = function(canvas, loaded, error) {
                    var dataURL = canvas.toDataURL('image/jpeg', 1.0),
                            img = new Image();
                    img.onload = loaded;
                    img.onerror = error;
                    img.style.background = "#FFF";
                    img.src = dataURL;
                };
                var img;
                var imageToPdf = function() {
                    // can't pass any parameters or else "this" won't be the img element
                    img = this;
                    var pdf = new jsPDF("p", "px", "letter"),
                            pdfcanvas = pdf.canvas,
                            pdfInternals = pdf.internal,
                            pdfPageSize = pdfInternals.pageSize,
                            pdfScaleFactor = pdfInternals.scaleFactor,
                            pdfPageWidth = pdfPageSize.width,
                            pdfPageHeight = pdfPageSize.height,
                            pdfPageWidthPx = (pdfPageWidth) * pdfScaleFactor,
                            pdfPageHeightPx = 554,
                            imgScaleFactor = Math.min(pdfPageWidthPx / img.width, 1),
                            imgScaledHeight = img.height,
                            shiftAmt = 0,
                            done = false;
                            contPage=0;

                    while (!done) {

                        var newCanvas = canvasShiftImg(img, shiftAmt, imgScaleFactor, pdfPageHeightPx, 419);

                          if(contPage==0){
                            pdf.addImage(newCanvas, 'JPEG', 20, 35, 419, Math.round(canvasHeight / 2.16606498195));
                          }
                          else{
                            pdf.addImage(newCanvas, 'JPEG', 20, 20, 419, Math.round(canvasHeight / 2.16606498195));
                          }
                            shiftAmt -= 1108;

                        contPage += 1;
                        if (-1 * shiftAmt < imgScaledHeight) {
                           pdf.addPage();

                        } else {
                            done = true;
                        }
                    }

                    pdf.save('Resumen.pdf');
                };
                var imageLoadError = function() {
                    alert('there was an image load error :(');
                };


                html2canvas(document.getElementById('div1'), {
                    background: "#FFF",
                    onrendered: function(canvas) {
                        // params: canvas, onload, onerror
                        canvasToImg(canvas, imageToPdf, imageLoadError);
                    }
                });
                $('#page-content-wrapper').height(tamanoInicial+'px');
            }


</script>
</div>
